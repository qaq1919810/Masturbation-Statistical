<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸ªäººä¿¡æ¯è®¾ç½®</title>
    <link rel="stylesheet" href="./css/initData.css">
    <link rel="stylesheet" href="./css/global.css">
    <script>
        // åˆå§‹åŒ–å…¨å±€å˜é‡
        let userInfo = {
            age: 91,
            sex: 'man'
        }

        // è‡ªå®šä¹‰æç¤ºæ¡†é€»è¾‘
        function showToast(text) {
            const toast = document.querySelector("#toast")
            toast.textContent = text
            toast.classList.add("show")

            setTimeout(function () {
                toast.classList.remove("show")
            }, 1500)
        }

        function initSettings() {
            const ageRange = document.querySelector("#ageRange")
            const ageInput = document.querySelector("#ageInput")
            const genderBtns = document.querySelectorAll(".gender-btn")
            const confirmBtn = document.querySelector("#confirmBtn")

            // æ ¸å¿ƒæ›´æ–°å‡½æ•°ï¼šå®ç°åŒå‘ç»‘å®š
            function updateAge(val) {
                let num = parseInt(val)

                // å¤„ç†éæ•°å­—è¾“å…¥
                if (isNaN(num)) return

                // è®°å½•æ•°æ®
                userInfo.age = num

                // åŒæ­¥æ»‘å—ä½ç½®ï¼ˆè‡ªåŠ¨å—é™åœ¨ -10 åˆ° 110ï¼‰
                ageRange.value = num
                // åŒæ­¥è¾“å…¥æ¡†å†…å®¹
                ageInput.value = num
            }

            if (ageRange && ageInput) {
                // 1. æ»‘å—é€»è¾‘
                ageRange.addEventListener("input", function (e) {
                    updateAge(e.target.value)
                })

                // 2. è¾“å…¥æ¡†é€»è¾‘
                ageInput.addEventListener("input", function (e) {
                    // ä»…å…è®¸æ•°å­—å’Œè´Ÿå·
                    let val = e.target.value.replace(/[^\d-]/g, "")
                    updateAge(val)
                })

                // 3. å¢å¼ºä½“éªŒï¼šç‚¹å‡»è‡ªåŠ¨å…¨é€‰æ•°å­—
                ageInput.addEventListener("click", function () {
                    this.select()
                })
            }

            // æ€§åˆ«é€‰æ‹©é€»è¾‘
            genderBtns.forEach(function (btn) {
                btn.addEventListener("click", function () {
                    genderBtns.forEach(function (b) { b.classList.remove("active") })
                    this.classList.add("active")

                    const text = this.textContent.trim()
                    userInfo.sex = text === 'ç”·' ? 'man' : 'woman'
                })
            })

            // ç¡®å®šæŒ‰é’®é€»è¾‘
            function handleConfirm() {
                const age = userInfo.age
                const hasActiveGender = document.querySelector(".gender-btn.active")

                if (!hasActiveGender || isNaN(age) || age < 1 || age > 100) {
                    showToast("ä½ çœŸçš„æ˜¯äººç±»å—")
                    return
                }

                if (age >= 1 && age <= 14) {
                    showToast("å°å°å¹´çºªï¼Œæ³¨æ„èŠ‚åˆ¶å“Ÿ")
                } else if (age >= 80 && age <= 100) {
                    showToast("è€å½“ç›Šå£®å‘€")
                } else {
                    showToast("è®¾å®šæˆåŠŸ")
                }

                const accountData = {
                    ...userInfo,
                    stats: []
                }

                localStorage.setItem("AccountData", JSON.stringify(accountData))

                confirmBtn.removeEventListener("click", handleConfirm)
                confirmBtn.classList.add("disabled")
                confirmBtn.textContent = "å·²å°±ç»ª"

                setTimeout(function () {
                    window.location.href = "./html/firstPage.html"
                }, 2000)
            }

            confirmBtn.addEventListener("click", handleConfirm)
        }

        document.addEventListener("DOMContentLoaded", function () {
            initSettings()
        })
    </script>
</head>
<body>
<div class="settings-container">
    <h2>è®¾ç½®</h2>

    <div class="section-title">ä¸ªäººä¿¡æ¯</div>

    <div class="card">
        <div class="info-item">
            <span class="icon">ğŸ‘¤</span>
            <div class="age-input-container">
                å¹´é¾„ï¼š<input type="number" id="ageInput" value="91"> å²
            </div>
        </div>
        <input type="range" id="ageRange" min="-10" max="110" value="91" class="slider">
        <span class="age-tip">Tip:ç‚¹å‡»æ•°å­—å¯ä»¥ç›´æ¥ä¿®æ”¹å“Ÿ</span>
    </div>

    <div class="card">
        <div class="info-item">
            <span class="icon">ğŸš»</span>
            <span>æ€§åˆ«</span>
        </div>
        <div class="gender-group">
            <button class="gender-btn active">ç”·</button>
            <button class="gender-btn">å¥³</button>
        </div>
    </div>

    <button id="confirmBtn" class="confirm-btn">ç¡®å®š</button>
</div>

<div id="toast" class="toast-msg"></div>
</body>
</html>